[scripts]
session_init = "echo Hello!"

pre_create = 'echo pre_create'

post_create_async = './setup.sh'
post_cleanup = 'echo post_cleanup'
pre_switch = 'echo pre_switch'
post_switch = 'echo post_switch'

post_create = """
CONTAINER_NAME="pg-$AUTOWT_BRANCH_NAME"
BASE_PORT=5432
PORT_RANGE=1000
HASH=$(echo "$AUTOWT_BRANCH_NAME" | md5sum | cut -c1-4)
OFFSET=$((16#$HASH % $PORT_RANGE))
PORT=$((BASE_PORT + OFFSET))

docker run -d \
  --name "$CONTAINER_NAME" \
  -e POSTGRES_PASSWORD=postgres \
  -p "$PORT:5432" \
  postgres:16

echo "DATABASE_URL=postgres://postgres:postgres@localhost:$PORT/postgres" >> .env
"""

pre_cleanup = """
CONTAINER_NAME="pg-$AUTOWT_BRANCH_NAME"
docker stop "$CONTAINER_NAME" 2>/dev/null || true
docker rm "$CONTAINER_NAME" 2>/dev/null || true
"""

[scripts.custom]
bugfix = 'claude "Investigate the GitHub issue $1. Propose a possible root cause based on evidence, and a well-considered fix. Think hard."'
demo = 'echo "ellew ellew"'

[scripts.custom.ghllm]
branch_name = "gh issue view $1 --json title --template '{{.title}}'"
session_init = 'claude "Work on GitHub issue $1"'
description = "Throw a coding agent at an issue"

[scripts.custom.ghcode]
branch_name = "gh issue view $1 --json title --template '{{.title}}'"
session_init = 'code .'
description = "Open VSCode in the worktree for an issue"
